---
title: "Project 1- Week 2 Reproducible Research"
#output: html_document

output: 
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Code for reading in the dataset and/or processing the data

```{r reading}
library(plyr); library(ggplot2);
setwd("/Users/Nael/Desktop/Coursera/5. Reproductible research/Week 2")
raw_data<-read.csv("activity.csv", header = TRUE)
data<-raw_data[!is.na(raw_data[,1]),] 
dim(data); summary(data)
```

## 2. Histogram of the total number of steps taken each day

```{r hist}
TotalStepsPerDay <- aggregate(data$steps, by=list(data$date), sum)  
names(TotalStepsPerDay)<-c("date","totalsteps")  # adjust column names
head(TotalStepsPerDay)  # data frame containing total steps for ech day
qplot(TotalStepsPerDay$totalsteps, bins=30)+
        labs(title = "Histogram of the total number of steps taken each day", x = "steps", y = "frequency") 
# as alternative: hist(TotalStepsPerDay$totalsteps, main="Histogram")
```

## 3. Mean and median number of steps taken each day
```{r mean&meadian}
mean(TotalStepsPerDay$totalsteps, na.rm = T)  # mean of the total number of steps taken per day
median(TotalStepsPerDay$totalsteps, na.rm = T) # median of the total number of steps taken per day
```

## 4. Time series plot of the average number of steps taken
```{r time_series}
AverageStepsPerTimeInterval<-aggregate(data$steps, by=list(data$interval), mean)
names(AverageStepsPerTimeInterval)<-c("interval","average steps")  # adjust column names
plot(AverageStepsPerTimeInterval[,1],AverageStepsPerTimeInterval[,2], type="l", xlab = "time interval", ylab="avrage steps", main="Average number of steps taken during the day")
```

# 5. The 5-minute interval that, on average, contains the maximum number of steps
```{r max_interval}
interval_index<-AverageStepsPerTimeInterval[,2]==(max(AverageStepsPerTimeInterval[,2]))
AverageStepsPerTimeInterval[interval_index,1]
```

## 6. Code to describe and show a strategy for imputing missing data
```{r NAs}
length(raw_data[is.na(raw_data[,1]),1]) # number of rows with missing values
```
Strategy: Use mean interval steps from **AverageStepsPerTimeInterval** for that interval.
```{r NAs2}
raw_data2<-merge(raw_data, AverageStepsPerTimeInterval, by="interval", all = TRUE)
raw_data2<-arrange(raw_data2,date,interval)   
NAs_vector<-is.na(raw_data2[,2])
raw_data2[NAs_vector,2]<-raw_data2[NAs_vector,4]
data_without_NAs<-raw_data2[,c(1,2,3)]  # new dataset that is equal to the original dataset but with the missing data filled in.
```

## 7. Histogram of the total number of steps taken each day after missing values are imputed
```{r hist2}
TotalStepsPerDay2 <- aggregate(data_without_NAs$steps, by=list(data_without_NAs$date), sum)  
names(TotalStepsPerDay2)<-c("date","totalsteps")  # adjust column names

qplot(TotalStepsPerDay2$totalsteps, bins=30)+ 
         labs(title = "Histogram of the total number of steps taken each day", x = "steps", y = "frequency")
```
Mean and median on new data:
```{r mean&median22}
mean(TotalStepsPerDay2$totalsteps, na.rm = FALSE)
median(TotalStepsPerDay2$totalsteps, na.rm = FALSE)
```
The effect of using mean data per interval as a data impute method for missing values seems to push overall data towards the mean.

## 8. Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends

We will work with the missing data imputed
```{r panel}
data_without_NAs$date <- as.Date(as.character(data_without_NAs$date))
data_without_NAs[,4]<-weekdays(data_without_NAs[,3])
data_without_NAs[,5]<-ifelse(data_without_NAs[,4]=="Sunday"|data_without_NAs[,4]=="Saturday", "Weekend", "Weekday")
names(data_without_NAs)[c(4,5)]<-c("day of the week", "weekday/weekend")
comparison<-aggregate(data_without_NAs$steps, by=list(data_without_NAs$`weekday/weekend`, data_without_NAs$interval), mean)
names(comparison)<-c("weekday_weekend", "interval", "average_steps")

ggplot(comparison, aes(x = interval, y=average_steps, color=weekday_weekend)) +
        geom_line() +
        facet_grid(weekday_weekend ~ .) +
        labs(title = "Mean of Steps by Interval", x = "time interval", y = "steps")

```


